/*
 AFHBA2G tester cfg on NODE07
 CGalperti 11.09.2020

 - test with state machine and transient auto termination
 - TCP message server to advance state machine
 - 1 thread 
 - MDS+ storage of cycle metadata
 - MDS+ storage of all ADCs
*/

+ShotManager = {
 Class = SPCShotManager
// Server = tcvscd.crpp.tcv
 Server = spcpc171.epfl.ch 
 Tree = rtc_state
 Shot = -1
 Statusnode = NODESTATE.NODE07.STATUS
 AbortScript = "/root/generic/postshot"
 //+OpenTreeMsg = { Class = Message Destination = RTApp.Data.MDSWriter Function = OpenTree Mode = ExpectsReply +Parameters = { Class = ConfigurationDatabase param1 = 0 } }
}

+TCPMessageProxy = {
    Class = TCPSocketMessageProxyExample
    Port = 24680
}

+StateMachine = {
 Class = StateMachine
 +INITIAL = {
  Class = ReferenceContainer
  +RUN = {
   Class = StateMachineEvent
   NextState = "RUN"
   NextStateError = "ERROR"
   Timeout = 0
   +ChangeToRunMsg = { Class = Message Destination = RTApp Function = PrepareNextState Mode = ExpectsReply +Parameters = { Class = ConfigurationDatabase param1 = Run } }
   +StartNextStateExecutionMsg = { Class = Message Destination = RTApp Function = StartNextStateExecution Mode = ExpectsReply }
   +ShotManagerStartMsg = { Class = Message Destination = ShotManager Function = Run Mode = ExpectsReply }
  }
  +ERROR = {
   Class = StateMachineEvent
   NextState = "ERROR"
   NextStateError = "ERROR"
   Timeout = 0
   +ShotManagerErrorMsg = { Class = Message Destination = ShotManager Function = Error Mode = ExpectsReply }
  }
  +EXIT = {
   Class = StateMachineEvent
   NextState = "FINAL"
   NextStateError = "ERROR"
   Timeout = 0
   +ExitAppMsg = { Class = Message Destination = ShotManager Function = Exit }
  }
  +ABORT = {
   Class = StateMachineEvent
   NextState = "FINAL"
   NextStateError = "ERROR"
   Timeout = 0
   +ExitAppMsg = { Class = Message Destination = ShotManager Function = Exit }
  }
 }
 +RUN = {
  Class = ReferenceContainer
  +RUNCOMPLETE = {
   Class = StateMachineEvent
   NextState = "ENDRUN"
   NextStateError = "ERROR"
   Timeout = 0
   +StopCurrentStateExecutionMsg = { Class = Message Destination = RTApp Function = StopCurrentStateExecution Mode = ExpectsReply }
   +MdsFlushSegmentsMsg1 = { Class = Message Destination = RTApp.Data.MDSWriter Function = FlushSegments Mode = ExpectsReply }
   +MdsFlushSegmentsMsg2 = { Class = Message Destination = RTApp.Data.MDSWriterADC Function = FlushSegments Mode = ExpectsReply }   
   +ShotManagerStopMsg = { Class = Message Destination = ShotManager Function = Stop Mode = ExpectsReply }
  }
  +ABORT = {
   Class = StateMachineEvent
   NextState = "FINAL"
   NextStateError = "ERROR"
   Timeout = 0
   +StopLLCMsg = { Class = Message Destination = RTApp.Data.ADCSystem Function = StopLLC Mode = ExpectsReply }
   +StopCurrentStateExecutionMsg = { Class = Message Destination = RTApp Function = StopCurrentStateExecution Mode = ExpectsReply }
   +ShotManagerAbortMsg = { Class = Message Destination = ShotManager Function = Abort Mode = ExpectsReply }
  }
 }
 +ENDRUN = {
  Class = ReferenceContainer
  +ENTER = {
   Class = ReferenceContainer
  }
  +EXIT = {
   Class = StateMachineEvent
   NextState = "FINAL"
   NextStateError = "ERROR"
   Timeout = 0
   +StopCurrentStateExecutionMsg = { Class = Message Destination = RTApp Function = StopCurrentStateExecution Mode = ExpectsReply }
   +ExitAppMsg = { Class = Message Destination = ShotManager Function = Exit }
  }
  +ABORT = {
   Class = StateMachineEvent
   NextState = "FINAL"
   NextStateError = "ERROR"
   Timeout = 0
   +StopCurrentStateExecutionMsg = { Class = Message Destination = RTApp Function = StopCurrentStateExecution Mode = ExpectsReply }
   +ExitAppMsg = { Class = Message Destination = ShotManager Function = Exit }
  }
 }
 +FINAL = {
  Class = ReferenceContainer
  +FINAL = {
   Class = StateMachineEvent
   NextState = "FINAL"
   NextStateError = "ERROR"
   Timeout = 0
  }
 }
 +ERROR = {
  Class = ReferenceContainer
  +ENTER = {
   Class = ReferenceContainer
   +ShotManagerErrorMsg = { Class = Message Destination = ShotManager Function = Error Mode = ExpectsReply }
  }
  +EXIT = {
   Class = StateMachineEvent
   NextState = "FINAL"
   NextStateError = "ERROR"
   Timeout = 0
   +ExitAppMsg = { Class = Message Destination = ShotManager Function = Exit }
  }
 }
}

$RTApp = {
    Class = RealTimeApplication
    +Functions = {
        Class = ReferenceContainer
        +ADCBroker = {
            Class = IOGAM
            InputSignals = {
                Counter = 		{ DataSource = ADCSystem Type = int32 }
                Time =    		{ DataSource = ADCSystem Type = int32 Frequency = 1000 }
                BufferId =      { DataSource = ADCSystem Type = uint8 }
                ADCs = 	        { DataSource = ADCSystem Type = int16 NumberOfElements = 64 Samples = 256 } 
            }
            OutputSignals = {
                Counter = 		{ DataSource = DDB1 Type = int32 }
                Time =    		{ DataSource = DDB1 Type = int32 }
                BufferId =      { DataSource = DDB1 Type = uint8 }
                ADCbuffer = 	{ DataSource = DDB1 Type = int16 NumberOfElements = 16384 } 
            }
        }
        +TimeSignals = {
        	Class = SPCTimeGAM
        	MdsTimeOffset = 0       
            MdsStartTime = -950000 
            MdsStopTime = 3950000                           
            InputSignals = {
            	Time  = { DataSource = DDB1     Type = int32 }
            }
            OutputSignals = {
                realtime         = { DataSource = DDB1 Type = float32     }
                offsettimeforMDS = { DataSource = DDB1 Type = int32       }
                triggerforMDS    = { DataSource = DDB1 Type = uint8       }
            }
        }
        +MDSBroker = {
            Class = IOGAM            
            InputSignals = {
                triggerforMDS                   = { DataSource = DDB1 		Type = uint8  }
                offsettimeforMDS                = { DataSource = DDB1 		Type = int32  }             
	            State1_Thread1_CycleTime 		= {	DataSource = Timings 	Type = uint32 	Alias = Run.Thread1_CycleTime }
	            ADCBroker_ReadTime       		= { DataSource = Timings    Type = uint32 }
	            ADCBroker_ExecTime       		= { DataSource = Timings    Type = uint32 }
	            ADCBroker_WriteTime      		= { DataSource = Timings    Type = uint32 }	        
	            MDSBroker_ReadTime       		= { DataSource = Timings    Type = uint32 }
	            MDSBroker_ExecTime       		= { DataSource = Timings    Type = uint32 }
	            MDSBroker_WriteTime      		= { DataSource = Timings    Type = uint32 }	        
	            MDSBrokerADC_ReadTime       	= { DataSource = Timings    Type = uint32 }
	            MDSBrokerADC_ExecTime       	= { DataSource = Timings    Type = uint32 }
	            MDSBrokerADC_WriteTime      	= { DataSource = Timings    Type = uint32 }	        	                
                Counter   						= {	DataSource = DDB1  		Type = int32 } 
				Time      						= { DataSource = DDB1  		Type = int32 }
                BufferId  						= { DataSource = DDB1       Type = uint8 }
                //ADC49     					= { DataSource = DDB1       Type = int16 Ranges={{ 12288   , 12543 }} Alias = ADCbuffer }
                //ADC50     					= { DataSource = DDB1       Type = int16 Ranges={{ 12544   , 12799 }} Alias = ADCbuffer }

            } 
            OutputSignals = {
                Trigger                         = { DataSource = MDSWriter  Type = uint8 }
            	Time                            = { DataSource = MDSWriter  Type = int32 }
	            State1_Thread1_CycleTime 		= { DataSource = MDSWriter 	Type = uint32}
	            ADCBroker_Time           		= { DataSource = MDSWriter  Type = uint32 NumberOfElements = 3 }
	            MDSBroker_Time           		= { DataSource = MDSWriter  Type = uint32 NumberOfElements = 3 }
	            MDSBrokerADC_Time           	= { DataSource = MDSWriter  Type = uint32 NumberOfElements = 3 }	            
                Counter  						= {	DataSource = MDSWriter  Type = int32 } 
				realtime     					= { DataSource = MDSWriter  Type = int32 }
                BufferId 						= { DataSource = MDSWriter  Type = uint8 }
                //ADC49    						= { DataSource = MDSWriter  Type = int16 Samples = 256 }
                //ADC50    						= { DataSource = MDSWriter  Type = int16 Samples = 256 }
			}
		}
		+MDSBrokerADC = {
			Class = IOGAM
			InputSignals = {
                triggerforMDS                   = { DataSource = DDB1 		Type = uint8  }
                offsettimeforMDS                = { DataSource = DDB1 		Type = int32  } 
                ADC01     = {                       DataSource = DDB1       Type = int16 Ranges={{     0   ,   255 }} Alias = ADCbuffer }
                ADC02     = {                       DataSource = DDB1       Type = int16 Ranges={{   256   ,   511 }} Alias = ADCbuffer }
                ADC03     = {                       DataSource = DDB1       Type = int16 Ranges={{   512   ,   767 }} Alias = ADCbuffer }
                ADC04     = {                       DataSource = DDB1       Type = int16 Ranges={{   768   ,  1023 }} Alias = ADCbuffer }
                ADC05     = {                       DataSource = DDB1       Type = int16 Ranges={{  1024   ,  1279 }} Alias = ADCbuffer }
                ADC06     = {                       DataSource = DDB1       Type = int16 Ranges={{  1280   ,  1535 }} Alias = ADCbuffer }
                ADC07     = {                       DataSource = DDB1       Type = int16 Ranges={{  1536   ,  1791 }} Alias = ADCbuffer }
                ADC08     = {                       DataSource = DDB1       Type = int16 Ranges={{  1792   ,  2047 }} Alias = ADCbuffer }
                ADC09     = {                       DataSource = DDB1       Type = int16 Ranges={{  2048   ,  2303 }} Alias = ADCbuffer }
                ADC10     = {                       DataSource = DDB1       Type = int16 Ranges={{  2304   ,  2559 }} Alias = ADCbuffer }
                ADC11     = {                       DataSource = DDB1       Type = int16 Ranges={{  2560   ,  2815 }} Alias = ADCbuffer }
                ADC12     = {                       DataSource = DDB1       Type = int16 Ranges={{  2816   ,  3071 }} Alias = ADCbuffer }
                ADC13     = {                       DataSource = DDB1       Type = int16 Ranges={{  3072   ,  3327 }} Alias = ADCbuffer }
                ADC14     = {                       DataSource = DDB1       Type = int16 Ranges={{  3328   ,  3583 }} Alias = ADCbuffer }
                ADC15     = {                       DataSource = DDB1       Type = int16 Ranges={{  3584   ,  3839 }} Alias = ADCbuffer }
                ADC16     = {                       DataSource = DDB1       Type = int16 Ranges={{  3840   ,  4095 }} Alias = ADCbuffer }
                ADC17     = {                       DataSource = DDB1       Type = int16 Ranges={{  4096   ,  4351 }} Alias = ADCbuffer }
                ADC18     = {                       DataSource = DDB1       Type = int16 Ranges={{  4352   ,  4607 }} Alias = ADCbuffer }
                ADC19     = {                       DataSource = DDB1       Type = int16 Ranges={{  4608   ,  4863 }} Alias = ADCbuffer }
                ADC20     = {                       DataSource = DDB1       Type = int16 Ranges={{  4864   ,  5119 }} Alias = ADCbuffer }
                ADC21     = {                       DataSource = DDB1       Type = int16 Ranges={{  5120   ,  5375 }} Alias = ADCbuffer }
                ADC22     = {                       DataSource = DDB1       Type = int16 Ranges={{  5376   ,  5631 }} Alias = ADCbuffer }
                ADC23     = {                       DataSource = DDB1       Type = int16 Ranges={{  5632   ,  5887 }} Alias = ADCbuffer }
                ADC24     = {                       DataSource = DDB1       Type = int16 Ranges={{  5888   ,  6143 }} Alias = ADCbuffer }
                ADC25     = {                       DataSource = DDB1       Type = int16 Ranges={{  6144   ,  6399 }} Alias = ADCbuffer }
                ADC26     = {                       DataSource = DDB1       Type = int16 Ranges={{  6400   ,  6655 }} Alias = ADCbuffer }
                ADC27     = {                       DataSource = DDB1       Type = int16 Ranges={{  6656   ,  6911 }} Alias = ADCbuffer }
                ADC28     = {                       DataSource = DDB1       Type = int16 Ranges={{  6912   ,  7167 }} Alias = ADCbuffer }
                ADC29     = {                       DataSource = DDB1       Type = int16 Ranges={{  7168   ,  7423 }} Alias = ADCbuffer }
                ADC30     = {                       DataSource = DDB1       Type = int16 Ranges={{  7424   ,  7679 }} Alias = ADCbuffer }
                ADC31     = {                       DataSource = DDB1       Type = int16 Ranges={{  7680   ,  7935 }} Alias = ADCbuffer }
                ADC32     = {                       DataSource = DDB1       Type = int16 Ranges={{  7936   ,  8191 }} Alias = ADCbuffer }
                ADC33     = {                       DataSource = DDB1       Type = int16 Ranges={{  8192   ,  8447 }} Alias = ADCbuffer }
                ADC34     = {                       DataSource = DDB1       Type = int16 Ranges={{  8448   ,  8703 }} Alias = ADCbuffer }
                ADC35     = {                       DataSource = DDB1       Type = int16 Ranges={{  8704   ,  8959 }} Alias = ADCbuffer }
                ADC36     = {                       DataSource = DDB1       Type = int16 Ranges={{  8960   ,  9215 }} Alias = ADCbuffer }
                ADC37     = {                       DataSource = DDB1       Type = int16 Ranges={{  9216   ,  9471 }} Alias = ADCbuffer }
                ADC38     = {                       DataSource = DDB1       Type = int16 Ranges={{  9472   ,  9727 }} Alias = ADCbuffer }
                ADC39     = {                       DataSource = DDB1       Type = int16 Ranges={{  9728   ,  9983 }} Alias = ADCbuffer }
                ADC40     = {                       DataSource = DDB1       Type = int16 Ranges={{  9984   , 10239 }} Alias = ADCbuffer }
                ADC41     = {                       DataSource = DDB1       Type = int16 Ranges={{ 10240   , 10495 }} Alias = ADCbuffer }
                ADC42     = {                       DataSource = DDB1       Type = int16 Ranges={{ 10496   , 10751 }} Alias = ADCbuffer }
                ADC43     = {                       DataSource = DDB1       Type = int16 Ranges={{ 10752   , 11007 }} Alias = ADCbuffer }
                ADC44     = {                       DataSource = DDB1       Type = int16 Ranges={{ 11008   , 11263 }} Alias = ADCbuffer }
                ADC45     = {                       DataSource = DDB1       Type = int16 Ranges={{ 11264   , 11519 }} Alias = ADCbuffer }
                ADC46     = {                       DataSource = DDB1       Type = int16 Ranges={{ 11520   , 11775 }} Alias = ADCbuffer }
                ADC47     = {                       DataSource = DDB1       Type = int16 Ranges={{ 11776   , 12031 }} Alias = ADCbuffer }
                ADC48     = {                       DataSource = DDB1       Type = int16 Ranges={{ 12032   , 12287 }} Alias = ADCbuffer }
                ADC49     = {                       DataSource = DDB1       Type = int16 Ranges={{ 12288   , 12543 }} Alias = ADCbuffer }
                ADC50     = {                       DataSource = DDB1       Type = int16 Ranges={{ 12544   , 12799 }} Alias = ADCbuffer }
                ADC51     = {                       DataSource = DDB1       Type = int16 Ranges={{ 12800   , 13055 }} Alias = ADCbuffer }
                ADC52     = {                       DataSource = DDB1       Type = int16 Ranges={{ 13056   , 13311 }} Alias = ADCbuffer }
                ADC53     = {                       DataSource = DDB1       Type = int16 Ranges={{ 13312   , 13567 }} Alias = ADCbuffer }
                ADC54     = {                       DataSource = DDB1       Type = int16 Ranges={{ 13568   , 13823 }} Alias = ADCbuffer }
                ADC55     = {                       DataSource = DDB1       Type = int16 Ranges={{ 13824   , 14079 }} Alias = ADCbuffer }
                ADC56     = {                       DataSource = DDB1       Type = int16 Ranges={{ 14080   , 14335 }} Alias = ADCbuffer }
                ADC57     = {                       DataSource = DDB1       Type = int16 Ranges={{ 14336   , 14591 }} Alias = ADCbuffer }
                ADC58     = {                       DataSource = DDB1       Type = int16 Ranges={{ 14592   , 14847 }} Alias = ADCbuffer }
                ADC59     = {                       DataSource = DDB1       Type = int16 Ranges={{ 14848   , 15103 }} Alias = ADCbuffer }
                ADC60     = {                       DataSource = DDB1       Type = int16 Ranges={{ 15104   , 15359 }} Alias = ADCbuffer }
                ADC61     = {                       DataSource = DDB1       Type = int16 Ranges={{ 15360   , 15615 }} Alias = ADCbuffer }
                ADC62     = {                       DataSource = DDB1       Type = int16 Ranges={{ 15616   , 15871 }} Alias = ADCbuffer }
                ADC63     = {                       DataSource = DDB1       Type = int16 Ranges={{ 15872   , 16127 }} Alias = ADCbuffer }
                ADC64     = {                       DataSource = DDB1       Type = int16 Ranges={{ 16128   , 16383 }} Alias = ADCbuffer }
        	}
        	OutputSignals = {
             	Trigger                         = { DataSource = MDSWriterADC Type = uint8 }
            	Time                            = { DataSource = MDSWriterADC Type = int32 }         	
                ADC01    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC02    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC03    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC04    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC05    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC06    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC07    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC08    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC09    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC10    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC11    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC12    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC13    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC14    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC15    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC16    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC17    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC18    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC19    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC20    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC21    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC22    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC23    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC24    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC25    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC26    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC27    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC28    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC29    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC30    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC31    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC32    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC33    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC34    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC35    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC36    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC37    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC38    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC39    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC40    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC41    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC42    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC43    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC44    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC45    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC46    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC47    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC48    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC49    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC50    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC51    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC52    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC53    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC54    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC55    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC56    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC57    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC58    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC59    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC60    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC61    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC62    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC63    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }
                ADC64    = {                        DataSource = MDSWriterADC  Type = int16 Samples = 256 }    	
        	}
        }        
    }
    +Data = {
        Class = ReferenceContainer
        DefaultDataSource = DDB1
        +DDB1 				= { Class = GAMDataSource }        
        +LoggerDataSource 	= { Class = LoggerDataSource }
        +Timings 			= { Class = TimingDataSource }                
        +ADCSystem = {
 	    	Class = AFHBA2G::ACQ196RTMTN07IN
			Device = 0 // Userspace device entry to be opened
			NBuffers = 16
			BufferLen = 32768
			ExecutionMode = RealTimeThread //Optional. If not set ExecutionMode = IndependentThread. If ExecutionMode == IndependentThread a thread is spawned to generate the time events. ExecutionMode == RealTimeThread the time is generated in the context of the real-time thread.
			//CPUMask = 0x8 //Optional and only relevant if ExecutionMode=IndependentThread
     		Cycles = 5000
     		StartTimeUsec = -1000000
     		// old HIC run scripts were (to be integrated here):
     		// /home/cristian/scripts/preparert.sh
     		// /root/generic/setup 100 110 500000 256000, the second parameter is the channel block mask, third and fourth not used anymore
     		// /root/generic/arm 
			RunScript = "/root/generic/arm"
			EndrunScript = "/root/generic/postshot"
            Signals = {
                Counter = {           // the cycle counter maintained by the ADC subsystem
                    Type = int32
                }
                Time = {              // the realtime maintained by the ADC subsystem, units [us]
                    Type = int32
                    Frequency = 1000  // The expected frequency of data production, see note (1)
                }
                BufferId = {
                    Type = uint8      // the last buffer id read
                }
                ADCs = {              // ADC inputs vector
                    Type = int16
                    NumberOfElements = 64 // See note (2)
                    Samples = 256 // See note (3)
                }
            }
         	+TermMessage1 = { Class=Message Destination=StateMachine Function=RUNCOMPLETE }
     	}              	       
        +MDSWriter = {
        	Class = MDSWriter::MDSWriter
			NumberOfBuffers = 6000
        	CPUMask = 0x04
        	StackSize = 10000000
        	TreeName = "martetest"
        	StoreOnTrigger = 1
        	//PulseNumber = 1
        	PulseNumber = -1
        	EventName = "updatejScope"
        	TimeRefresh = 5
        	NumberOfPreTriggers = 0
			NumberOfPostTriggers = 0
			Signals = {
			    Trigger  = { Type = uint8 }      
                Time     = { Type = int32 TimeSignal = 1 TimeSignalMultiplier = 1e-6 }   	
	            State1_Thread1_CycleTime = {		NodeName = "ST.CH01"  Period = 0.001 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 }
                Counter  = {		  				NodeName = "ST.CH02"  Period = 0.001 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 } 
				realtime     = {                    NodeName = "ST.CH03"  Period = 0.001 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 }
                BufferId = {                        NodeName = "ST.CH04"  Period = 0.001 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 }
	            ADCBroker_Time           = {        NodeName = "ST.CH05"  Period = 0.001 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 NumberOfElements = 3}
	            MDSBroker_Time           = {        NodeName = "ST.CH06"  Period = 0.001 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 NumberOfElements = 3}
	            MDSBrokerADC_Time        = {        NodeName = "ST.CH07"  Period = 0.001 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 NumberOfElements = 3}	            
                //ADC49    = {                        NodeName = "AI.CH049" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                //ADC50    = {                        NodeName = "AI.CH050" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }        	
        	}
        }          
        +MDSWriterADC = {
        	Class = MDSWriter::MDSWriter
			NumberOfBuffers = 6000
        	CPUMask = 0x04
        	StackSize = 250000000
        	TreeName = "martetest"
        	StoreOnTrigger = 1
        	//PulseNumber = 1
        	PulseNumber = 0 // WARNING: depending on MARTe2 init call order, avoid this in production 
        	EventName = "updatejScope"
        	TimeRefresh = 5
        	NumberOfPreTriggers = 0
			NumberOfPostTriggers = 0
			Signals = { 
			    Trigger  = { Type = uint8 }      
                Time     = { Type = int32 TimeSignal = 1 TimeSignalMultiplier = 1e-6 }              
                ADC01    = {                        NodeName = "AI.CH001" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC02    = {                        NodeName = "AI.CH002" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC03    = {                        NodeName = "AI.CH003" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC04    = {                        NodeName = "AI.CH004" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC05    = {                        NodeName = "AI.CH005" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC06    = {                        NodeName = "AI.CH006" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC07    = {                        NodeName = "AI.CH007" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC08    = {                        NodeName = "AI.CH008" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC09    = {                        NodeName = "AI.CH009" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC10    = {                        NodeName = "AI.CH010" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC11    = {                        NodeName = "AI.CH011" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC12    = {                        NodeName = "AI.CH012" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC13    = {                        NodeName = "AI.CH013" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC14    = {                        NodeName = "AI.CH014" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC15    = {                        NodeName = "AI.CH015" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC16    = {                        NodeName = "AI.CH016" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC17    = {                        NodeName = "AI.CH017" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC18    = {                        NodeName = "AI.CH018" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC19    = {                        NodeName = "AI.CH019" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC20    = {                        NodeName = "AI.CH020" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC21    = {                        NodeName = "AI.CH021" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC22    = {                        NodeName = "AI.CH022" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC23    = {                        NodeName = "AI.CH023" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC24    = {                        NodeName = "AI.CH024" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC25    = {                        NodeName = "AI.CH025" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC26    = {                        NodeName = "AI.CH026" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC27    = {                        NodeName = "AI.CH027" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC28    = {                        NodeName = "AI.CH028" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC29    = {                        NodeName = "AI.CH029" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC30    = {                        NodeName = "AI.CH030" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC31    = {                        NodeName = "AI.CH031" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC32    = {                        NodeName = "AI.CH032" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC33    = {                        NodeName = "AI.CH033" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC34    = {                        NodeName = "AI.CH034" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC35    = {                        NodeName = "AI.CH035" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC36    = {                        NodeName = "AI.CH036" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC37    = {                        NodeName = "AI.CH037" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC38    = {                        NodeName = "AI.CH038" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC39    = {                        NodeName = "AI.CH039" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC40    = {                        NodeName = "AI.CH040" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC41    = {                        NodeName = "AI.CH041" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC42    = {                        NodeName = "AI.CH042" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC43    = {                        NodeName = "AI.CH043" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC44    = {                        NodeName = "AI.CH044" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC45    = {                        NodeName = "AI.CH045" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC46    = {                        NodeName = "AI.CH046" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC47    = {                        NodeName = "AI.CH047" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC48    = {                        NodeName = "AI.CH048" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC49    = {                        NodeName = "AI.CH049" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC50    = {                        NodeName = "AI.CH050" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC51    = {                        NodeName = "AI.CH051" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC52    = {                        NodeName = "AI.CH052" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC53    = {                        NodeName = "AI.CH053" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC54    = {                        NodeName = "AI.CH054" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC55    = {                        NodeName = "AI.CH055" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC56    = {                        NodeName = "AI.CH056" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC57    = {                        NodeName = "AI.CH057" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC58    = {                        NodeName = "AI.CH058" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC59    = {                        NodeName = "AI.CH059" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC60    = {                        NodeName = "AI.CH060" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC61    = {                        NodeName = "AI.CH061" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC62    = {                        NodeName = "AI.CH062" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC63    = {                        NodeName = "AI.CH063" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
                ADC64    = {                        NodeName = "AI.CH064" Period = 3.90625e-06 MakeSegmentAfterNWrites = 25000 AutomaticSegmentation = 0 SamplePhase=0 }
        	}        
        }    
    }
    +States = {
        Class = ReferenceContainer
        +Run = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = { 
                	Class = RealTimeThread CPUs = 0x02
                	Functions = {
                	  ADCBroker 
                	  TimeSignals
                	  MDSBroker 
                	  MDSBrokerADC
                	} 
                }
            }
        }
                    
    }
    +Scheduler = {
        Class = GAMScheduler
        TimingDataSource = Timings
    }
}
